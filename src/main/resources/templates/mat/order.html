<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/template}">



<head>
  <meta charset="UTF-8" />
  <title>자재발주관리</title>

  <style>
    .ordersearch {
      border: 1px solid black;
      padding: 20px;
    }

    .inputbtn {
      width: 5px 15px;
      background-color: #282cff;
      border: none;
      color: white;
      text-align: center;
      display: inline-block;
      font-size: 16px;
      float: right;
      margin: 20px;
    }

    .submitbtn {
      width: 5px 10px;
      background-color: #282cff;
      border: none;
      color: white;
      text-align: center;
      display: inline-block;
      font-size: 16px;
      float: right;
      margin: 0 10px;
    }

    #grid {
      margin: 20px 0 10px;
    }

    .text1 {
      margin: 15px;
      padding: 0 5px 0 0;
    }

  </style>
	<script src="https://kit.fontawesome.com/56e7c5522c.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
  <link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css">
  <script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.js"></script>
  <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
  <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
  <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
  <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

</head>


<body>
  <div layout:fragment="title">
    <h3>자재발주관리</h3>
  </div>
  <div layout:fragment="content">
    <div class="ordersearch">
      <label>발주번호</label>
      <input class="text1" readonly>
      <label>자재명</label>
      <input class="text1" type="text">
      <button type="button" class="btn btn-primary fa-solid fa-magnifying-glass" data-toggle="modal" data-target=".bd-example-modal-lg"></button>
      <label>납기일</label>
      <input class="text1" type="date"><br>
      <label>거래처명</label>
      <input class="text1" type="text">
      <label>담당자</label>
      <input class="text1" type="text">
      <button type="button" class="inputbtn">조회</button>
    </div>

    <!-- 자재명모달 -->
    <div class="modal fade bd-example-modal-lg" id="matmodalbtn" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
      	<h5 class="modal-title">자재목록</h5>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>      
      </div>
      <div class="modal-body">
        <label>자재명</label>
        <input class="modaltext" type="text" id="ckmat-text">
        <button class="ckmatmodalbtn" type="button" id="ckmat">조회</button>
      	<div id="modal-grid"></div>
        <button class="submitmatmodalbtn" type="button">저장</button>
      </div>
    </div>
  </div>
</div>





    <div id="grid"></div>

    <button type="button" class="submitbtn">발주요청</button>

    <script>
      //자재명모달     
      /* $(".btn-modal").click(function () {
      var data = $(this).data('id');
	      $("#contents.body-contents").val(data);
	      $("#text-contents.body-contents").html(data);
      }); */

      


     //grid
    $.ajax({
    url : "/mat/orderListAjax",
    method : "GET",
    dataType : "JSON",
    success : function(result){
    grid.resetData(result);
    grid.refreshLayout();
    }
    });

    var grid = new tui.Grid({
    el: document.getElementById('grid'),
    scrollX: false,
    scrollY: false,
    rowHeaders: ['checkbox'],
    columns: [{
    header: '발주번호',
    name: 'matOrdernum'
    },
    {
    header: '발주명',
    name: 'matOrdername'
    },
    {
    header: '자재코드',
    name: 'matCode'
    },
    {
    header: '자재명',
    name: 'matName'
    },
    {
    header: '거래처명',
    name: 'accCode'
    },
    {
    header: '납기일',
    name: 'matReqdate'
    },
    {
    header: '담당자',
    name: 'matCharger'
    },
    {
    header: '단가',
    name: 'matUntpc'
    },
    {
    header: '발주량',
    name: 'matOrderQy'
    },
    {
    header: '총금액',
    name: 'matTotamt'
    }
    ]
    });

    
  //자재명모달
    $.ajax({
        url : "/mat/matlist",
        method : "GET",
        dataType : "JSON",
        success : function(result){
          modal_grid.resetData(result);
          modal_grid.refreshLayout();
        }
      });

      var modal_grid = new tui.Grid({
        el: document.getElementById('modal-grid'),
        scrollX: false,
        scrollY: false,
        rowHeaders: ['checkbox'],
        columns: [{
          header: '자재코드',
          name: 'matCode'
        },
        {
          header: '자재명',
          name: 'matName'
        },
        {
          header: '단위',
          name: 'matUnit'
        }
      ]
    })
      
    
    $(function(){  
    $('#matmodalbtn').on('shown.bs.modal', function(){
      modal_grid.refreshLayout();
    });
    })
    
    
    //자재모달검색조회
    $("#ckmat").on('click', function(){
    	console.log($("#ckmat-text").val())
    	const result = $("#ckmat-text").val()
		$("#ckmat-text").val('');
    	
    	$.ajax({
    		 url : "/mat/matminilist",
    	     method : "GET",
    	     data : {'result' : result},
    	     success : function(result){
    	     modal_grid.resetData(result);
    	     modal_grid.refreshLayout();
    	     },
    	     error: function(reject){
    	    	 console.log(reject)
    	     }
  
    });
    })


    
    
    
    </script>

    </div>
    
    </body>
    
    </html>