<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  layout:decorate="~{layout/template}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title>Pen Service</title>
    <script src="https://kit.fontawesome.com/56e7c5522c.js" crossorigin="anonymous"></script>
    <!-- 그리드 -->
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
    <style>
      tr .modified {
        background-color: rgba(255, 255, 0, 0.3);
      }
      .tui-datepicker {
        z-index: 100;
      }

      .tui-ico-date {
        position: absolute;
        top: 50%;
        right: 20px;
        margin: -6px 0 0 0;
        background-position: -17px -14px;
      }
    </style>
  </head>
  <body>
    <div layout:fragment="title">검사 내역 조회</div>
    <!-- 메인컨텐츠 -->
    <div layout:fragment="content">
      <div class="row justify-content-center" style="margin-bottom: 10px">
        <div class="row col-4">
          <div class="col-3">
            <label class="col-form-label" for="">조회항목 </label>
          </div>
          <div class="row col-9">
            <div class="col-auto">
              <input type="radio" id="mat" name="type" value="mat" style="margin-right: 5px" checked />
              <label class="col-form-label" for="mat">자재입고</label>
            </div>
            <div class="col-auto">
              <input type="radio" id="item" name="type" value="item" style="margin-right: 5px" />
              <label class="col-form-label" for="item">제품</label>
            </div>
            <div class="col-auto">
              <input type="radio" id="exp" name="type" value="exp" style="margin-right: 5px" />
              <label class="col-form-label" for="exp">보관기간초과</label>
            </div>
          </div>
        </div>
        <div class="row col-8"></div>
      </div>

      <!-- 자재 입고 검사 내역 -->
      <div class="row justify-content-center" style="margin-bottom: 10px">
        <div class="row col-3">
          <div class="col-4">
            <label class="col-form-label" id="matNameLabel" for="itemName">자재명</label>
            <label class="col-form-label" id="itemNameLabel" for="itemName" style="display: none">제품명</label>
          </div>
          <div class="col-8">
            <input type="text" class="form-control" id="itemName" name="itemName" />
          </div>
        </div>
        <div class="row col-6">
          <div class="col-auto">
            <label class="col-form-label" for="" style="margin-left: 20px">검사일자</label>
          </div>
          <div class="col-auto" style="position: relative">
            <input id="startpicker-input" class="form-control" type="text" aria-label="Date" />
            <span class="tui-ico-date"></span>
            <div id="startpicker-container" style="margin-left: -1px"></div>
          </div>
          <span class="col-1 col-form-label">~</span>
          <div class="col-auto" style="position: relative">
            <input id="endpicker-input" class="form-control" type="text" aria-label="Date" />
            <span class="tui-ico-date"></span>
            <div id="endpicker-container" style="margin-left: -1px"></div>
          </div>
        </div>
        <div class="row col-3 justify-content-end">
          <div class="col-auto">
            <button class="btn btn-primary" id="search" style="height: 38px">조건 조회</button>
          </div>
          <div class="col-auto">
            <button class="btn btn-primary" id="all" style="height: 38px">전체 조회</button>
          </div>
          <div class="col-auto">
            <button class="btn btn-light" id="export" style="height: 38px">
              <img src="/excel.png" style="width: 30px" alt="엑셀로 출력" />
            </button>
          </div>
        </div>
      </div>
      <!-- 자재 입고 검사 내역 -->
      <div id="matGrid"></div>
      <div id="itemGrid" style="display: none"></div>
      <div id="expGrid" style="display: none"></div>
      <script src="/plugins/jquery/jquery.min.js"></script>
      <script>
        $(function () {
          const token = $('meta[name="_csrf"]').attr("content");
          const header = $('meta[name="_csrf_header"]').attr("content");
          // 메인그리드시작;

          //그리드폼 시작
          const matGrid = new tui.Grid({
            el: document.getElementById("matGrid"),
            contextMenu: null,
            data: {
              contentType: "application/json",
              api: {
                readData: {
                  url: "/qip/matView",
                  method: "GET",
                },
              },
            },
            bodyHeight: 650,
            scrollX: false,
            rowHeaders: ["rowNum"],
            columns: [
              {
                header: "검사번호",
                name: "qipCodeListMat",
                align: "center",
                hidden: true,
              },
              {
                header: "발주번호",
                name: "matOrdernum",
                align: "center",
              },
              {
                header: "자재명",
                name: "matName",
                align: "center",
              },
              {
                header: "검사일자",
                name: "testDate",
                align: "center",
              },
              {
                header: "검사자",
                name: "empName",
                align: "center",
              },
              {
                header: "검사수량",
                name: "testNumMat",
                align: "center",
              },
              {
                header: "총합격량",
                name: "testTnumPass",
                align: "center",
              },
              {
                header: "총불량량",
                name: "testTnumDef",
                align: "center",
              },
            ],
          });
          const itemGrid = new tui.Grid({
            el: document.getElementById("itemGrid"),
            contextMenu: null,
            data: {
              contentType: "application/json",
              api: {
                readData: {
                  url: "/qip/itemView",
                  method: "GET",
                },
              },
            },
            bodyHeight: 650,
            scrollX: false,
            rowHeaders: ["rowNum"],
            columns: [
              {
                header: "검사번호",
                name: "qipCodeListProd",
                align: "center",
              },
              {
                header: "생산지시번호",
                name: "indicaCode",
                align: "center",
              },
              {
                header: "제품명",
                name: "prodName",
                align: "center",
              },
              {
                header: "발생공정명",
                name: "procName",
                align: "center",
              },
              {
                header: "검사일자",
                name: "testDate",
                align: "center",
              },
              {
                header: "검사자",
                name: "empName",
                align: "center",
              },
              {
                header: "검사수량",
                name: "testNumMat",
                align: "center",
              },
              {
                header: "총합격량",
                name: "testTnumPass",
                align: "center",
              },
              {
                header: "총불량량",
                name: "testTnumDef",
                align: "center",
              },
            ],
          });
          //그리드 폼 끝

          //라디오 버튼 누를시 타겟 grid 변경
          let grid = matGrid;
          let radioVal = "mat";
          $("input[name=type]").on("change", (e) => {
            let mat = $("#matGrid");
            let item = $("#itemGrid");
            let exp = $("#expGrid");
            radioVal = $("input[name=type]:checked").val();
            if (radioVal == "mat") {
              grid = matGrid;
              item.hide();
              exp.hide();
              mat.show();
              grid.refreshLayout();
            } else if (radioVal == "item") {
              grid = itemGrid;
              mat.hide();
              exp.hide();
              item.show();
              grid.refreshLayout();
            } else {
              grid = expGrid;
              mat.hide();
              item.hide();
              exp.show();
              grid.refreshLayout();
            }
          });

          //tui grid의 언어세팅
          tui.Grid.setLanguage("ko");

          // 전체 조회 버튼 동작
          $("#all").click((e) => {
            grid.setRequestParams();
            grid.readData();
          });

          // 조건 조회 버튼 동작
          $("#search").click((e) => {
            grid.setRequestParams({
              itemName: $("#itemName").val(),
              startDate: $("#startpicker-input").val(),
              endDate: $("#endpicker-input").val(),
            });
            grid.readData();
          });
        });
      </script>

      <script th:inline="none">
        //dateRangePicker
        $(function () {
          var today = new Date();
          var picker = tui.DatePicker.createRangePicker({
            startpicker: {
              date: today,
              input: "#startpicker-input",
              container: "#startpicker-container",
            },
            endpicker: {
              date: today,
              input: "#endpicker-input",
              container: "#endpicker-container",
            },
            selectableRanges: [[new Date(2010, 0, 1), today]],
            format: "YYYY-MM-dd",
            language: "ko",
          });
        });
      </script>
    </div>
    <!-- 메인컨텐츠 끝 -->
  </body>
</html>
