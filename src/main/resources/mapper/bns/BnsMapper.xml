<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.pen.app.bns.mapper.BnsMapper">

<!-- 주문서 전체 조회 -->
  <select id="getOrdList" resultType="BnsOrdVO">
select o.ord_code ord_code, acc_code, acc_name, to_char(ord_date,'YYYY-MM-DD') as ord_date, to_char(ord_due_date,'YYYY-MM-DD') as ord_due_date, ord_progress, e.emp_name emp_name, ord_note, prod_code, prod_name, ord_det_price, ord_det_quan,ord_det_progress
from bns_order_detail d join bns_order o 
on(d.ord_code =o.ord_code)
join com_info_emp e
on(o.emp_num = e.emp_num)
  </select>
  
   <!-- 주문서 조건 조회 -->
   <select id="getOrdListCon" resultType="BnsOrdVO">
	select *
	from bns_order_detail d join bns_order o 
	on(d.ord_code =o.ord_code)
	where acc_name =#{accName} and prod_name = #{prodName} and ord_date = #{ordDate} and ord_due_date = #{ordDueDate}
  </select> 
  
  
  
<!-- 주문서 등록 -->
  <insert id="insertOrdList">
  insert all into bns_order values(#{ordCode},#{accCode},#{accName},#{ordDate},#{ordDueDate},#{ordProgress},#{empNum},#{ordNote})
  			 into bns_order_detail values(#{ordDetCode},#{ordCode},#{prodCode},#{prodName},#{ordDetPrice},#{ordDetQuan},#{ordDetProgress})
  			 select * from dual
  </insert>

  
  <!-- 거래처코드,거래처명 조회 -->
  <select id="getAccList" resultType="BnsAccVO">
   select acc_code, acc_name 
   from com_code_account
  </select>
  
  <!-- 거래처코드, 거래처명 검색 조회 -->
  <select id ="getAccKeyList" resultType="BnsAccVO">
  select acc_code, acc_name
  from com_code_account
  where acc_name =#{keyword}
  </select>
  
  
  <!-- 제품코드, 제품명 조회 -->
  <select id="getProdList" resultType="BnsProdVO">
   select prod_code, prod_name
   from com_code_prod
  </select>
  
  <!-- 제품코드, 제품명 검색 조회 -->
  <select id="getProdKeyList" resultType="BnsProdVO">
  select prod_code, prod_name
   from com_code_prod
   where prod_name = #{keyword}
  </select>
  
  <!-- 주문코드,현재날짜 조회 -->
    <select id="getOrdCode" resultType="BnsOrdVO">
	select 'bns_ord_'||max(lpad(subStr(ord_code,-3)+1,3,'0')) ord_code, to_char(sysdate,'YYYY-MM-DD') as ord_date  from bns_order
	</select>
	
	
</mapper>
