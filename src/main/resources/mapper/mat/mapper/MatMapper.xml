<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.pen.app.mat.mapper.MatMapper">
	<select id="getorderlist" resultType="OrderVO">
		select h.MAT_ORDERNUM, h.MAT_ORDERNAME, h.MAT_CHARGER, h.ACC_CODE, o.MAT_UNTPC, o.MAT_ORDER_QY, o.MAT_TOTAMT, o.MAT_ORDERNUM, o.MAT_REQDATE, o.MAT_CODE, o.MAT_NAME,o.MAT_DTAORDCODE
		from MAT_ORDER_HEADER h, MAT_ORDER o
		where h.MAT_ORDERNUM=o.MAT_ORDERNUM
		and o.mat_name='자재명'
	</select>
	
	<!-- 모달자재목록 -->
	<select id="getmatlist" resultType="OrderVO">
		select a.acc_code, a.acc_name, c.mat_code, c.mat_name from COM_CODE_ACCOUNT a join COM_ACCOUNT_ITEM b on (a.acc_code = b.acc_code) join COM_CODE_MAT c on (b.acc_item = c.mat_code)
	</select>
	
	<!-- 모달자재검색조회 -->
	<select id="getmatminilist" resultType="OrderVO">
		select a.acc_code, a.acc_name, c.mat_code, c.mat_name from COM_CODE_ACCOUNT a join COM_ACCOUNT_ITEM b on (a.acc_code = b.acc_code) join COM_CODE_MAT c on (b.acc_item = c.mat_code) where c.mat_name like #{keyword}
	</select>
	
	<!-- 모달거래처목록 -->
	<select id="getacclist" resultType="OrderVO">
		SELECT * FROM COM_CODE_ACCOUNT
	</select>
	
	<!-- 모달거래처검색조회 -->
	<select id="getaccminilist" resultType="OrderVO">
		SELECT * FROM COM_CODE_ACCOUNT where ACC_CODE like #{keyword}
	</select>
	
	<select id="getmatordercode" resultType="String">
		SELECT COM_CODE||'-'||LPAD((SELECT LAST_NUMBER FROM USER_SEQUENCES WHERE SEQUENCE_NAME = 'MAT_ORDER_HEADER_SEQ'),6,'0') AS MAT_CODE FROM COM_CODE WHERE CODE_NAME =  '자재코드'
	</select>
	
	
	
	<select id="getmatregister" >
	insert all
	into MAT_ORDER_HEADER(MAT_ORDERNUM, ACC_CODE, MAT_ORDERNAME, MAT_ORDERDATE, MAT_CHARGER) values ('MAT-ORD-'||mat_order_header_seq.nextval, #{list[0].accCode}, #{list[0].matOrdername}, sysdate, #{list[0].matCharger})	
	<foreach collection="list" item="vo" close="select * from dual" index="idx" separator=" ">
	into MAT_ORDER (MAT_DTAORDCODE, MAT_ORDERNUM, MAT_CODE, MAT_NAME, MAT_ORDER_QY, MAT_UNTPC, MAT_TOTAMT, MAT_REQDATE)
    values(GET_ORDER_SEQ, 'MAT-ORD-'||mat_order_header_seq.currval, #{vo.matCode}, #{vo.matName}, #{vo.matOrderQy}, #{vo.matUntpc}, #{vo.matTotamt},  to_date('2023-05-30','YYYY-MM-DD'))   
	</foreach>	
	</select>
	
	<select id = "getwarehousinglist" resultType="WarehousingVO">
		select * from qip_list_mat
	</select>
</mapper>
